(()=>{var e={};e.id=2162,e.ids=[2162],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14752:e=>{"use strict";e.exports=require("pino-pretty")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},98188:e=>{"use strict";e.exports=require("module")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},30029:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>y,originalPathname:()=>u,pages:()=>d,routeModule:()=>c,tree:()=>l});var s=n(50482),r=n(69108),a=n(62563),i=n.n(a),o=n(68300),p={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(p[e]=()=>o[e]);n.d(t,p);let l=["",{children:["verify-otp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,44762)),"/home/sandyagur/Desktop/payzapp/packages/nextjs/app/verify-otp/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(n.bind(n,47436)),"/home/sandyagur/Desktop/payzapp/packages/nextjs/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/home/sandyagur/Desktop/payzapp/packages/nextjs/app/verify-otp/page.tsx"],u="/verify-otp/page",y={require:n,loadChunk:()=>Promise.resolve()},c=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/verify-otp/page",pathname:"/verify-otp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},16247:(e,t,n)=>{Promise.resolve().then(n.bind(n,73181))},83832:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});class s{constructor(e){this.kintoUrl="https://engen.kinto.xyz",this.appAddress=e,this.iframeId="kinto-sdk-iframe",this.modalId="kinto-sdk-modal"}async connect(){let e=document.getElementById(this.iframeId),t=document.getElementById(this.modalId);if(!e||!t){(e=document.createElement("iframe")).id="kinto-sdk-iframe",e.src=`${this.kintoUrl}/connect?appDomain=${encodeURIComponent(window.location.origin)}&appAddress=${this.appAddress}`,e.allow="publickey-credentials-get *",e.style.width="100%",e.style.height="100%",e.style.border="none",(t=document.createElement("div")).id="kinto-sdk-modal",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.display="none",t.style.justifyContent="center",t.style.alignItems="center";let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.backgroundColor="white",n.style.borderRadius="8px",n.style.overflow="hidden",n.appendChild(e),t.appendChild(n),document.body.appendChild(t)}return new Promise((e,n)=>{let s=r=>{r.origin===this.kintoUrl&&("KINTO_ACCOUNT_INFO"===r.data.type?(window.removeEventListener("message",s),e(r.data.accountInfo),t.style.display="none"):"KINTO_CONNECTION_ERROR"===r.data.type&&(window.removeEventListener("message",s),t.style.display="none",n(Error(r.data.error))))};window.addEventListener("message",s)})}async sendTransaction(e){if(0===e.length)return;let t=document.getElementById(this.iframeId),n=document.getElementById(this.modalId);if(t&&n)return n.style.display="flex",t?.contentWindow?.postMessage({type:"KINTO_SEND_TX",txs:e},this.kintoUrl),new Promise((e,t)=>{let s=r=>{r.origin===this.kintoUrl&&("KINTO_TX_SUCCESS"===r.data.type?(window.removeEventListener("message",s),e(r.data.hash),n.style.display="none"):"KINTO_TX_ERROR"===r.data.type&&(window.removeEventListener("message",s),t(Error(r.data.error)),n.style.display="none"))};window.addEventListener("message",s)})}async createNewWallet(){return new Promise((e,t)=>{let n=window.screen.width/2-200,s=window.screen.height/2-350;if(!window.open(`${this.kintoUrl}/onboarding?appDomain=${encodeURIComponent(window.location.origin)}`,"Kinto Onboarding",`width=400,height=700,left=${n},top=${s}`)){t(Error("Failed to open popup. Please allow popups for this site."));return}e()})}}let r=e=>new s(e)},45773:(e,t,n)=>{"use strict";n.d(t,{x:()=>s}),(0,n(67413).a)({id:7887,name:"Kinto",network:"kinto",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://rpc.kinto-rpc.com/"],webSocket:["wss://rpc.kinto.xyz/ws"]}},blockExplorers:{default:{name:"Explorer",url:"https://kintoscan.io"}}});let s=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InvalidShortString",type:"error"},{inputs:[{internalType:"string",name:"str",type:"string"}],name:"StringTooLong",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[],name:"EIP712DomainChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"eip712Domain",outputs:[{internalType:"bytes1",name:"fields",type:"bytes1"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"uint256",name:"chainId",type:"uint256"},{internalType:"address",name:"verifyingContract",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"uint256[]",name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},73181:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var s=n(95344),r=n(3729),a=n(22254),i=n(45773),o=n(83832),p=n(86615),l=n(76295);function d(){let[e,t]=(0,r.useState)(""),[n,d]=(0,r.useState)(!1),u=(0,a.useRouter)(),y=(0,a.useSearchParams)(),[c,m]=(0,r.useState)(),h=(0,r.useRef)(!1),x="0x9A33eF90660321a8aeAfDca271d594d5b052E2DE";if(!x)throw Error("No Dispatcher address set");let b="0x8208DFaEef51B4a8EaAe4d6Dbaa310F59F4881B2";if(!b)throw Error("No USDC address set");let f="0x9A33eF90660321a8aeAfDca271d594d5b052E2DE";if(!f)throw Error("KINTO APP ADDRESS IS NOT SET");let g=(0,o.O)(f);(0,r.useEffect)(()=>{if(!1===h.current){let e=Math.random().toString(36).substring(2,8).toUpperCase();return t(`C8D7M 1 ${e}`),fetch(`/api/user/verify?otp=${e}&method=1&number=91${y.get("phone")}`).then(e=>{e.ok||(alert("There is some issue. Please restart the process"),u.push("/signup"))}),()=>{h.current=!0}}},[u]);let w=async()=>{try{console.log(e.split(" ")[2]),console.log(y.get("phone"));let t=await fetch(`/api/user/verify?otp=${e.split(" ")[2]}&method=2&number=91${y.get("phone")}`);if(!t.ok)throw Error("Verification failed");if((await t.json()).isVerified){await g.createNewWallet();let e=await g.connect();if(m(e),console.log({newAccountInfo:e}),e){let t={email:y.get("email"),name:`91${y.get("name")}`,phoneNumber:y.get("phone"),isMerchant:y.get("isMerchant"),walletAddress:e.walletAddress};console.log({userData:t});let n=await fetch("/api/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log({createResponse:n}),!n.ok)throw Error("Failed to create user");d(!0)}}else throw Error("Verification failed")}catch(e){console.error("Error during verification:",e),alert("There is some issue. Please restart the process"),u.push("/signup")}},v=async()=>{let e=(0,p.R)({abi:i.x,functionName:"approve",args:[x,(0,l.f)("10000")]});await g.sendTransaction([{to:`0x${b.slice(2)}`,data:e,value:BigInt(0)}]),d(!1),c?.walletAddress?u.push(`/wallet?accountInfo="${c.walletAddress}"`):(console.error("Wallet address is undefined"),u.push("/signup"))};return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col",children:[s.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white shadow-md rounded-lg p-6",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Verify Your Phone Number"}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("p",{className:"text-lg font-medium",children:"Your OTP:"}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("span",{className:"text-2xl font-bold",children:e}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e),alert("OTP copied to clipboard!")},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Copy to Clipboard"})]})]}),s.jsx("div",{className:"mb-6",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["To verify your phone number, copy the above string and send it to this phone number:",s.jsx("br",{}),s.jsx("span",{className:"font-medium",children:s.jsx("button",{onClick:()=>{navigator.clipboard.writeText("+919220592205"),alert("Phone number copied to clipboard!")},className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",children:"+919220592205"})}),s.jsx("br",{}),"After sending the message, wait for 10 seconds and click the verify button."]})}),s.jsx("button",{onClick:w,className:"w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Verify"})]})}),n&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-lg",children:[s.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Verification Successful!"}),s.jsx("p",{children:"Your account has been verified and created successfully."}),s.jsx("button",{onClick:v,className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Approve Wallet and goto profile"})]})})]})}},44762:(e,t,n)=>{"use strict";n.r(t),n.d(t,{$$typeof:()=>a,__esModule:()=>r,default:()=>i});let s=(0,n(86843).createProxy)(String.raw`/home/sandyagur/Desktop/payzapp/packages/nextjs/app/verify-otp/page.tsx`),{__esModule:r,$$typeof:a}=s,i=s.default}};var t=require("../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[1638,1658,7878],()=>n(30029));module.exports=s})();