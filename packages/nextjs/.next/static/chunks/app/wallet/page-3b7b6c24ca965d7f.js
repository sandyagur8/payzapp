(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3597],{93058:function(e,t,n){"use strict";n.d(t,{O:function(){return s}});class a{constructor(e){this.kintoUrl="https://engen.kinto.xyz",this.appAddress=e,this.iframeId="kinto-sdk-iframe",this.modalId="kinto-sdk-modal"}async connect(){let e=document.getElementById(this.iframeId),t=document.getElementById(this.modalId);if(!e||!t){(e=document.createElement("iframe")).id="kinto-sdk-iframe",e.src=`${this.kintoUrl}/connect?appDomain=${encodeURIComponent(window.location.origin)}&appAddress=${this.appAddress}`,e.allow="publickey-credentials-get *",e.style.width="100%",e.style.height="100%",e.style.border="none",(t=document.createElement("div")).id="kinto-sdk-modal",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.display="none",t.style.justifyContent="center",t.style.alignItems="center";let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.backgroundColor="white",n.style.borderRadius="8px",n.style.overflow="hidden",n.appendChild(e),t.appendChild(n),document.body.appendChild(t)}return new Promise((e,n)=>{let a=s=>{s.origin===this.kintoUrl&&("KINTO_ACCOUNT_INFO"===s.data.type?(window.removeEventListener("message",a),e(s.data.accountInfo),t.style.display="none"):"KINTO_CONNECTION_ERROR"===s.data.type&&(window.removeEventListener("message",a),t.style.display="none",n(Error(s.data.error))))};window.addEventListener("message",a)})}async sendTransaction(e){if(0===e.length)return;let t=document.getElementById(this.iframeId),n=document.getElementById(this.modalId);if(t&&n)return n.style.display="flex",t?.contentWindow?.postMessage({type:"KINTO_SEND_TX",txs:e},this.kintoUrl),new Promise((e,t)=>{let a=s=>{s.origin===this.kintoUrl&&("KINTO_TX_SUCCESS"===s.data.type?(window.removeEventListener("message",a),e(s.data.hash),n.style.display="none"):"KINTO_TX_ERROR"===s.data.type&&(window.removeEventListener("message",a),t(Error(s.data.error)),n.style.display="none"))};window.addEventListener("message",a)})}async createNewWallet(){return new Promise((e,t)=>{let n=window.screen.width/2-200,a=window.screen.height/2-350;if(!window.open(`${this.kintoUrl}/onboarding?appDomain=${encodeURIComponent(window.location.origin)}`,"Kinto Onboarding",`width=400,height=700,left=${n},top=${a}`)){t(Error("Failed to open popup. Please allow popups for this site."));return}e()})}}let s=e=>new a(e)},47513:function(e,t,n){Promise.resolve().then(n.bind(n,72142))},93933:function(e,t,n){"use strict";n.d(t,{x:function(){return a}}),(0,n(71186).a)({id:7887,name:"Kinto",network:"kinto",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://rpc.kinto-rpc.com/"],webSocket:["wss://rpc.kinto.xyz/ws"]}},blockExplorers:{default:{name:"Explorer",url:"https://kintoscan.io"}}});let a=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InvalidShortString",type:"error"},{inputs:[{internalType:"string",name:"str",type:"string"}],name:"StringTooLong",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[],name:"EIP712DomainChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"eip712Domain",outputs:[{internalType:"bytes1",name:"fields",type:"bytes1"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"uint256",name:"chainId",type:"uint256"},{internalType:"address",name:"verifyingContract",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"uint256[]",name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},72142:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var a=n(57437),s=n(2265),l=n(24930),r=n.n(l),i=n(24033),o=n(93058),d=n(76384),c=n(59494),u=n(93933);let p="0x9A33eF90660321a8aeAfDca271d594d5b052E2DE";if(!p)throw Error("KINTO_APP_ADDRESS is not defined");let m=(0,o.O)(p),y=r()(()=>n.e(8627).then(n.t.bind(n,10782,23)),{loadableGenerated:{webpack:()=>[10782]},ssr:!1});function h(e){let{onClose:t}=e,[n,l]=(0,s.useState)(!0),[r,o]=(0,s.useState)(""),[p,h]=(0,s.useState)(""),[x,f]=(0,s.useState)(""),[b,w]=(0,s.useState)(!1),g=(0,i.useRouter)(),j=async e=>{if(e.preventDefault(),n&&r&&p)g.push("/offlineTransaction?phoneNumber=".concat(r,"&amount=").concat(p));else{let e="0x"==x.slice(0,2)?await fetch("/api/user/get?walletAddress=".concat(x)):await fetch("/api/user/get?phoneNumber=".concat(x)),n=await e.json(),a=(0,d.R)({abi:u.x,functionName:"transfer",args:[n.walletAddress,(0,c.f)(p)]});await m.connect(),m.sendTransaction([{to:"0x".concat("0x8208DFaEef51B4a8EaAe4d6Dbaa310F59F4881B2".slice(2)),data:a,value:BigInt(0)}]).then(e=>{console.log("Transaction successful, hash:",e)}).catch(e=>{console.error("Transaction failed:",e)}),console.log("Online transaction:",{walletAddress:x,amount:p}),t()}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Send Funds"}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",className:"sr-only",checked:n,onChange:()=>l(!n)}),(0,a.jsx)("div",{className:"block w-14 h-8 rounded-full ".concat(n?"bg-blue-400":"bg-gray-300")}),(0,a.jsx)("div",{className:"dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition ".concat(n?"":"transform translate-x-6")})]}),(0,a.jsx)("div",{className:"ml-3 text-gray-700 font-medium",children:n?"Offline Payment":"Online Payment"})]})}),b?(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)(y,{delay:300,onError:e=>{console.error(e)},onScan:e=>{e&&(f(e.text),w(!1))},style:{width:"100%"}}),(0,a.jsx)("button",{onClick:()=>w(!1),className:"mt-2 w-full bg-red-600 text-white px-4 py-2 rounded",children:"Cancel Scan"})]}):(0,a.jsxs)("form",{onSubmit:j,children:[n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"tel",placeholder:"Phone Number",value:r,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border rounded mb-4",required:!0}),(0,a.jsx)("input",{type:"number",placeholder:"Amount",value:p,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border rounded mb-4",required:!0})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",placeholder:"Wallet Address or Phone Number",value:x,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded mb-4",required:!0}),(0,a.jsx)("input",{type:"number",placeholder:"Amount",value:p,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border rounded mb-4",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>w(!0),className:"w-full bg-gray-200 text-gray-800 px-4 py-2 rounded mb-4",children:"Scan QR Code"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 border rounded",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:n?"Continue":"Send"})]})]})]})})}var x=n(92395);function f(e){let{onClose:t,walletAddress:n}=e,[l,r]=(0,s.useState)("");return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Receive Funds"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("input",{type:"number",placeholder:"Amount (optional)",value:l,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(x.tv,{value:n,size:200})}),(0,a.jsx)("p",{className:"text-center text-sm mb-2",children:"Scan this QR code to receive funds"}),(0,a.jsx)("p",{className:"text-center text-xs text-gray-500 break-all",children:n})]}),(0,a.jsx)("button",{onClick:t,className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Close"})]})})}var b=e=>{let{transactions:t}=e;return(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Transaction History"}),t.length>0?(0,a.jsx)("ul",{children:t.map(e=>(0,a.jsx)("li",{className:"border-b py-2 last:border-b-0",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.type}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"sent"===e.type?"To: ".concat(e.to):"From: ".concat(e.from)})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-medium ".concat("sent"===e.type?"text-red-600":"text-green-600"),children:["$",e.amount]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.created_at})]})]})},e.id))}):(0,a.jsx)("p",{className:"text-gray-500",children:"No transactions to display."})]})},w=e=>{let{wallet_connect:t}=e,[n,l]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[p,m]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/wallet/balance?walletAddres=".concat(t.walletAddress));if(!e.ok)throw Error("Failed to fetch balance");let n=await e.json();d(n.balance);let a=await fetch("/api/wallet/history?walletAddress=".concat(t.walletAddress));if(!a.ok)throw Error("Failed to fetch transaction history");let s=await a.json();console.log({historyData:s}),u(s.transactions)}catch(e){console.error("Error fetching wallet data:",e)}finally{m(!1)}})()},[t.walletAddress]),p)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-xl font-semibold",children:"Loading wallet data..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,a.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold mb-4",children:["Welcome, ",t.name]}),(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Wallet Balance"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:["$",null!==o?o.toFixed(2):"00.00"]})]}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)("button",{onClick:()=>l(!0),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Send Funds"}),(0,a.jsx)("button",{onClick:()=>i(!0),className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Receive Funds"})]}),(0,a.jsx)(b,{transactions:c})]}),n&&(0,a.jsx)(h,{onClose:()=>l(!1)}),r&&(0,a.jsx)(f,{walletAddress:t.walletAddress,onClose:()=>i(!1)})]})};function g(e){let{onClose:t}=e;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"XMTP Alerts"}),(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto",children:[{id:1,title:"New Event: Blockchain Conference",description:"Join us for the annual blockchain conference in your area!"},{id:2,title:"Special Offer: 20% off on crypto purchases",description:"Limited time offer for all merchant wallet users."},{id:3,title:"Security Update",description:"Important security update for your merchant wallet. Please update your app."}].map(e=>(0,a.jsxs)("div",{className:"mb-4 p-4 bg-gray-100 rounded",children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.id))}),(0,a.jsx)("button",{onClick:t,className:"mt-4 w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Close"})]})})}var j=e=>{let{wallet_connect:t}=e,[n,l]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),[o,d]=(0,s.useState)(0),c=t.walletAddress,[u,p]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/wallet/balance?walletAddres=".concat(t.walletAddress));if(!e.ok)throw Error("Failed to fetch balance");let n=await e.json();d(n.balance);let a=await fetch("/api/wallet/history?walletAddress=".concat(t.walletAddress));if(!a.ok)throw Error("Failed to fetch transaction history");let s=await a.json();console.log({historyData:s}),p(s.transactions)}catch(e){console.error("Error fetching wallet data:",e)}finally{console.log("done")}})()},[t.walletAddress]),(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,a.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Wallet Balance"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:["$",o.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Receive Payments"}),(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(x.tv,{value:c,size:200})}),(0,a.jsx)("p",{className:"text-center text-sm mb-2",children:"Scan this QR code to receive payments"}),(0,a.jsx)("p",{className:"text-center text-xs text-gray-500 break-all",children:c})]}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)("button",{onClick:()=>l(!0),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Send"}),(0,a.jsx)("button",{className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Attest"})]}),(0,a.jsx)(b,{transactions:u}),(0,a.jsxs)("div",{className:"flex space-x-4 mt-6",children:[(0,a.jsx)("button",{className:"flex-1 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"Link with HW"}),(0,a.jsx)("button",{onClick:()=>i(!0),className:"flex-1 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700",children:"XMTP Alerts"})]})]}),n&&(0,a.jsx)(h,{onClose:()=>l(!1)}),r&&(0,a.jsx)(g,{onClose:()=>i(!1)})]})};function v(){let[e,t]=(0,s.useState)(!1),[n,l]=(0,s.useState)(!0),[r,o]=(0,s.useState)(null),d=(0,i.useSearchParams)();return((0,s.useEffect)(()=>{let e=async e=>!!e.isMerchant&&e.isMerchant;(async()=>{l(!0);try{let n=d.get("accountInfo");if(n)try{let a=JSON.parse(decodeURIComponent(n)),s=await fetch("/api/user/get?walletAddress=".concat(a));if(console.log({response:s}),!s.ok)throw Error("Failed to fetch user type");let l=await s.json();t(await e(l)),o(l)}catch(e){console.error("Failed to parse account info or fetch user type:",e)}else console.error("No account info found in URL parameters")}catch(e){console.error("Error checking user type:",e)}finally{l(!1)}})()},[d]),!r||n)?(0,a.jsx)("div",{children:"Loading..."}):e?(0,a.jsx)(j,{wallet_connect:r}):(0,a.jsx)(w,{wallet_connect:r})}},24930:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let a=n(21024);n(2265);let s=a._(n(84795));function l(e){return{default:(null==e?void 0:e.default)||e}}function r(e,t){let n=s.default,a={loading:e=>{let{error:t,isLoading:n,pastDelay:a}=e;return null}};"function"==typeof e&&(a.loader=e),Object.assign(a,t);let r=a.loader;return n({...a,loader:()=>null!=r?r().then(l):Promise.resolve(l(()=>null))})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},16005:function(e,t,n){"use strict";function a(e){let{children:t}=e;return t}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NoSSR",{enumerable:!0,get:function(){return a}}),n(46491)},84795:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let a=n(21024)._(n(2265)),s=n(16005),l=function(e){let t=Object.assign({loader:null,loading:null,ssr:!0},e);function n(e){let n=t.loading,l=a.default.createElement(n,{isLoading:!0,pastDelay:!0,error:null}),r=t.ssr?a.default.Fragment:s.NoSSR,i=t.lazy;return a.default.createElement(a.default.Suspense,{fallback:l},a.default.createElement(r,null,a.default.createElement(i,e)))}return t.lazy=a.default.lazy(t.loader),n.displayName="LoadableComponent",n}},24033:function(e,t,n){e.exports=n(15313)}},function(e){e.O(0,[7549,2395,2971,8822,1744],function(){return e(e.s=47513)}),_N_E=e.O()}]);