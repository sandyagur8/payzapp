(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2162],{93058:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});class a{constructor(e){this.kintoUrl="https://engen.kinto.xyz",this.appAddress=e,this.iframeId="kinto-sdk-iframe",this.modalId="kinto-sdk-modal"}async connect(){let e=document.getElementById(this.iframeId),t=document.getElementById(this.modalId);if(!e||!t){(e=document.createElement("iframe")).id="kinto-sdk-iframe",e.src=`${this.kintoUrl}/connect?appDomain=${encodeURIComponent(window.location.origin)}&appAddress=${this.appAddress}`,e.allow="publickey-credentials-get *",e.style.width="100%",e.style.height="100%",e.style.border="none",(t=document.createElement("div")).id="kinto-sdk-modal",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.display="none",t.style.justifyContent="center",t.style.alignItems="center";let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.backgroundColor="white",n.style.borderRadius="8px",n.style.overflow="hidden",n.appendChild(e),t.appendChild(n),document.body.appendChild(t)}return new Promise((e,n)=>{let a=i=>{i.origin===this.kintoUrl&&("KINTO_ACCOUNT_INFO"===i.data.type?(window.removeEventListener("message",a),e(i.data.accountInfo),t.style.display="none"):"KINTO_CONNECTION_ERROR"===i.data.type&&(window.removeEventListener("message",a),t.style.display="none",n(Error(i.data.error))))};window.addEventListener("message",a)})}async sendTransaction(e){if(0===e.length)return;let t=document.getElementById(this.iframeId),n=document.getElementById(this.modalId);if(t&&n)return n.style.display="flex",t?.contentWindow?.postMessage({type:"KINTO_SEND_TX",txs:e},this.kintoUrl),new Promise((e,t)=>{let a=i=>{i.origin===this.kintoUrl&&("KINTO_TX_SUCCESS"===i.data.type?(window.removeEventListener("message",a),e(i.data.hash),n.style.display="none"):"KINTO_TX_ERROR"===i.data.type&&(window.removeEventListener("message",a),t(Error(i.data.error)),n.style.display="none"))};window.addEventListener("message",a)})}async createNewWallet(){return new Promise((e,t)=>{let n=window.screen.width/2-200,a=window.screen.height/2-350;if(!window.open(`${this.kintoUrl}/onboarding?appDomain=${encodeURIComponent(window.location.origin)}`,"Kinto Onboarding",`width=400,height=700,left=${n},top=${a}`)){t(Error("Failed to open popup. Please allow popups for this site."));return}e()})}}let i=e=>new a(e)},234:function(e,t,n){Promise.resolve().then(n.bind(n,80768))},93933:function(e,t,n){"use strict";n.d(t,{x:function(){return a}}),(0,n(71186).a)({id:7887,name:"Kinto",network:"kinto",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://rpc.kinto-rpc.com/"],webSocket:["wss://rpc.kinto.xyz/ws"]}},blockExplorers:{default:{name:"Explorer",url:"https://kintoscan.io"}}});let a=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InvalidShortString",type:"error"},{inputs:[{internalType:"string",name:"str",type:"string"}],name:"StringTooLong",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[],name:"EIP712DomainChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"eip712Domain",outputs:[{internalType:"bytes1",name:"fields",type:"bytes1"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"uint256",name:"chainId",type:"uint256"},{internalType:"address",name:"verifyingContract",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"uint256[]",name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},80768:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var a=n(57437),i=n(2265),s=n(24033),r=n(93933),o=n(93058),l=n(76384),d=n(59494);function p(){let[e,t]=(0,i.useState)(""),[n,p]=(0,i.useState)(!1),u=(0,s.useRouter)(),y=(0,s.useSearchParams)(),[c,m]=(0,i.useState)(),h=(0,i.useRef)(!1),b="0x9A33eF90660321a8aeAfDca271d594d5b052E2DE";if(!b)throw Error("No Dispatcher address set");let f="0x8208DFaEef51B4a8EaAe4d6Dbaa310F59F4881B2";if(!f)throw Error("No USDC address set");let w="0x9A33eF90660321a8aeAfDca271d594d5b052E2DE";if(!w)throw Error("KINTO APP ADDRESS IS NOT SET");let g=(0,o.O)(w);(0,i.useEffect)(()=>{if(!1===h.current){let e=Math.random().toString(36).substring(2,8).toUpperCase();return t("C8D7M 1 ".concat(e)),fetch("/api/user/verify?otp=".concat(e,"&method=1&number=91").concat(y.get("phone"))).then(e=>{e.ok||(alert("There is some issue. Please restart the process"),u.push("/signup"))}),()=>{h.current=!0}}},[u]);let T=async()=>{try{console.log(e.split(" ")[2]),console.log(y.get("phone"));let t=await fetch("/api/user/verify?otp=".concat(e.split(" ")[2],"&method=2&number=91").concat(y.get("phone")));if(!t.ok)throw Error("Verification failed");if((await t.json()).isVerified){await g.createNewWallet();let e=await g.connect();if(m(e),console.log({newAccountInfo:e}),e){let t={email:y.get("email"),name:"91".concat(y.get("name")),phoneNumber:y.get("phone"),isMerchant:y.get("isMerchant"),walletAddress:e.walletAddress};console.log({userData:t});let n=await fetch("/api/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log({createResponse:n}),!n.ok)throw Error("Failed to create user");p(!0)}}else throw Error("Verification failed")}catch(e){console.error("Error during verification:",e),alert("There is some issue. Please restart the process"),u.push("/signup")}},x=async()=>{let e=(0,l.R)({abi:r.x,functionName:"approve",args:[b,(0,d.f)("10000")]});await g.sendTransaction([{to:"0x".concat(f.slice(2)),data:e,value:BigInt(0)}]),p(!1),(null==c?void 0:c.walletAddress)?u.push('/wallet?accountInfo="'.concat(c.walletAddress,'"')):(console.error("Wallet address is undefined"),u.push("/signup"))};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,a.jsx)("main",{className:"flex-grow container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto bg-white shadow-md rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Verify Your Phone Number"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-lg font-medium",children:"Your OTP:"}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,a.jsx)("span",{className:"text-2xl font-bold",children:e}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(e),alert("OTP copied to clipboard!")},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Copy to Clipboard"})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["To verify your phone number, copy the above string and send it to this phone number:",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"font-medium",children:(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText("+919220592205"),alert("Phone number copied to clipboard!")},className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",children:"+919220592205"})}),(0,a.jsx)("br",{}),"After sending the message, wait for 10 seconds and click the verify button."]})}),(0,a.jsx)("button",{onClick:T,className:"w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Verify"})]})}),n&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"Verification Successful!"}),(0,a.jsx)("p",{children:"Your account has been verified and created successfully."}),(0,a.jsx)("button",{onClick:x,className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Approve Wallet and goto profile"})]})})]})}},24033:function(e,t,n){e.exports=n(15313)}},function(e){e.O(0,[7549,2971,8822,1744],function(){return e(e.s=234)}),_N_E=e.O()}]);